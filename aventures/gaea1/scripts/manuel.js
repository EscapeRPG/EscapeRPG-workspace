const fullText = `
	[SECTION: Module d'Assistance Robotique (MAR)]
	[IMAGE: marv.png]
	[PAGEBREAK]
	
	[SECTION: Protocoles de navigation]
	Maintenir le cap selon les coordonnées fournies par le Commandement Central.
	Recalibrer les senseurs toutes les 72 heures de vol.
	En cas d'anomalie gravitationnelle, enclencher le mode "Stabilisation".
	[PAGEBREAK]
	
	[SECTION: Procédures d'atterrissage sur Planète Non Répertoriée (PNR)]
	Scan atmosphérique obligatoire avant toute descente.
	Si l'atmosphère est viable : procéder à un repérage orbital durant 3 rotations locales.
	Si l'atmosphère est non viable : cartographier et transmettre au Commandement pour analyse.
	[PAGEBREAK]
	
	[SECTION: Protocole de découverte de vie intelligente]
	Aucune interaction directe avant analyse complète des signaux.
	Capturer et archiver toutes les données visuelles, sonores et énergétiques.
	Envoyer un rapport prioritaire au Commandement avec balise d'alerte de niveau AURORA.
	[PAGEBREAK]
	
	[SECTION: Gestion des signaux de détresse]
	
	[PAGEBREAK]
	
	[SECTION: Communication interstellaire]
	Utiliser le réseau de relais pour toute communication longue portée.
	Les rapports de mission doivent être chiffrés selon le protocole Omega-3.
	En cas de brouillage, attendre 12 heures et réessayer depuis un point relais différent.
	[PAGEBREAK]
	
	[SECTION: Les langues dans l'univers]
	<div class="citation">"Le langage fabrique les gens bien plus que les gens ne fabriquent le langage."</div>
	<h3 class="auteur">—Johann Wolfgang von Goethe, date inconnue.</h3>
	Depuis l'aube de l'humanité, sur la Planète Terre, de nombreux langages ont été créés et utilisés.<br>
	Certains ont perduré, d'autres non.<br>
	<br>
	Avec l'Exode, nous avons conquis l'espace et de nouveaux territoires se sont ouverts à nous.
	Bien entendu, la distance séparant les êtres humains s'étant considérablement agrandie, de nouvelles langues ont émergé.<br>
	Toutefois, il est intéressant de constater que la plupart d'entre elles sont constituées des principales langues de notre planète natale.<br>
	<br>
	Le module <i>M-A-R</i> dont votre vaisseau est équipé embarque avec lui un puissant compilateur de données permettant de créer un traducteur dans la grande majorité des cas.<br>
	Si vous êtes face à une langue qui vous est inconnue, branchez simplement votre équipement sur un terminal et le module <i>M-A-R</i> s'occupera de la compilation.<br>
	<br>
	Son algorithme fonctionne sur une base schématique que vous pourrez trouver dans les pages suivantes et analyse les éléments principaux du langage : la syntaxe, la conjugaison et la grammaire.
	[PAGEBREAK]

	<h1>Afrikaneer</h1>
	[IMAGE: afrikaneer.png]
	Née de la rencontre entre le néerlandais, les langues locales d'Afrique australe et les mutations du temps, l'afrikaans — devenu afrikaneer dans les archives spatiales —
	a longtemps été cantonné à une région du monde oubliée des grandes puissances.
	Mais à la fin du second millénaire, alors que ces dernières s'effondraient, l'afrikaneer a émergé avec fierté dans une Afrique en pleine réinvention.<br>
	<br>
	Portée par des mouvements culturels, éducatifs et technologiques, la langue s'est modernisée rapidement et a servi de pilier à plusieurs projets d'exploration avant l'Exode.
	Dans certaines colonies proches de l'orbite martienne et sur les avant-postes miniers de la Ceinture, elle a même brièvement dominé les communications locales.<br>
	<br>
	Aujourd'hui, l'afrikaneer n'est plus qu'un murmure dans l'écho des transmissions, mais quelques expressions, rudes et imagées, ont infiltré les argots spatiaux.
	Elle reste un symbole d'émancipation pour ceux qui refusent de disparaître dans l'uniformité.
	[PAGEBREAK]

	<h1>Allemand</h1>
	[IMAGE: allemand.png]
	Langue de philosophes, d'ingénieurs et de poètes, l'allemand a rayonné pendant des siècles au cœur de l'Europe.
	Avant l'Exode, il était encore solidement implanté dans plusieurs régions terrestres, mais sa complexité grammaticale et son isolement culturel relatif ont freiné son expansion interstellaire.<br>
	<br>
	Avec le départ des premiers vaisseaux-colonies, une grande partie des germanophones s'est fondue dans des communautés plus vastes,
	adoptant des langues hybrides ou plus simples pour survivre à la promiscuité des arches spatiales.<br>
	<br>
	Aujourd'hui, l'allemand survit dans quelques foyers linguistiques préservés, sur des stations-musées ou dans des cercles universitaires nostalgiques.<br>
	<br>
	Parmi les expressions conservées dans la mémoire collective, une subsiste : Weltenschmerz, "la douleur du monde" — comme un écho d'un passé révolu.
	[PAGEBREAK]

	<h1>Anglais</h1>
	[IMAGE: anglais.png]
	Originaire des îles britanniques, l'anglais a connu une expansion fulgurante dès le second millénaire, devenant la langue dominante dans les échanges internationaux, scientifiques et technologiques.<br>
	<br>
	Durant les premiers siècles de l'Exode, il a servi de base à de nombreuses formes de communication interplanétaires, donnant naissance à des créoles orbitaux, des jargons techniques,
	et des variantes locales sur les colonies.<br>
	<br>
	Aujourd'hui, même si la plupart des humains parlent une version dérivée ou hybridée, l'anglais "classique" reste enseigné dans les académies spatiales pour des raisons historiques et diplomatiques.<br>
	<br>
	On dit souvent que, dans l'espace, l'anglais n'a jamais cessé de flotter – il s'est simplement transformé.
	[PAGEBREAK]

	<h1>Arabe</h1>
	[IMAGE: arabe.png]
	Langue millénaire aux racines nomades, l'arabe a traversé les âges avec une richesse poétique et spirituelle inégalée.
	Parlé sur trois continents, il a longtemps été la langue de la science, du commerce et de la foi.
	Mais avec l'avènement de l'Exode et la nécessité d'unifier les moyens de communication, l'alphabet arabe — jugé difficile à transcrire dans les interfaces universelles —
	a peu à peu cédé la place à des graphies latines ou phonétiques.<br>
	<br>
	La langue n'a pourtant pas disparu.
	Ses tournures, ses rythmes, ses formules de salutation ou de bénédiction se sont glissés dans les langages composites de l'espace, donnant une couleur particulière à certaines variantes du Basic Galactique.
	Des mots comme <i>salam</i>, <i>inshallah</i> ou <i>habibi</i> résonnent bien souvent dans les couloirs pressurisés des stations.<br>
	<br>
	L'arabe n'est plus une langue, dit-on, mais une musique qui continue de flotter entre les étoiles.
	[PAGEBREAK]

	<h1>Chinois Unifié</h1>
	[IMAGE: chinois.png]
	Né de l'unification progressive des parlers mandarin, cantonais, hakka et autres dialectes régionaux, le chinois unifié a vu le jour bien avant l'Exode,
	dans un effort colossal de cohérence linguistique à l'échelle d'une civilisation-monde.
	Ce compromis fluide, fondé sur la phonétique simplifiée, a permis à la langue de survivre à la fragmentation planétaire et de s'étendre sans heurts dans les premières colonies orbitales.<br>
	<br>
	L'introduction de l'alphabet latin dans son écriture – d'abord utilitaire, ensuite systématique dans les interfaces spatiales – n'a pas effacé les idéogrammes d'origine.
	Ces derniers, toujours enseignés sur plusieurs mondes cœur, sont utilisés dans les arts, les rituels, ou les noms personnels à haute valeur symbolique.<br>
	<br>
	Langue du commerce interplanétaire, de l'administration spatiale et des proverbes qui traversent le vide, le chinois unifié reste aujourd'hui l'un des piliers des communications humaines.
	On dit que si le Basic Galactique est la voix, alors le chinois est le souffle qui la porte.
	[PAGEBREAK]

	<h1>Coréen</h1>
	[IMAGE: coreen.png]
	Structuré, efficace, conçu pour être appris rapidement : le coréen, fort de son alphabet unique — le hangeul — a connu une seconde jeunesse au tournant du troisième millénaire, peu avant l'Exode.
	Sa clarté syntaxique et sa compatibilité naturelle avec les interfaces numériques en ont fait la langue privilégiée de nombreuses IA, logiciels de bord et systèmes de communication embarqués.<br>
	<br>
	À mesure que les colonies s'étendaient, le coréen s'est diffusé dans les sphères techniques et culturelles, notamment grâce à l'influence des mégapoles coréennes de la Terre pré-Exode,
	devenues des centres de coordination spatiale.
	Il est aujourd'hui la seconde langue asiatique la plus parlée dans les Territoires du Noyau, et reste dominant dans certains conglomérats industriels interstellaires. <br>
	<br>
	Le hangeul est toujours utilisé, notamment dans les zones autonomes et les bases de la Diaspora, mais une version latinisée est largement adoptée pour les échanges officiels.<br>
	<br>
	Dans l'univers connu, rares sont les pilotes qui ne comprennent pas au moins quelques mots de coréen.
	[PAGEBREAK]

	<h1>Espagnol</h1>
	[IMAGE: espagnol.png]
	Langue des explorateurs, des poètes et des révolutions, l'espagnol a traversé les siècles comme un vent chaud chargé de récits.
	Avant l'Exode, il était déjà parlé sur plusieurs continents, résultat d'un long héritage colonial, de fusions culturelles et de migrations massives.<br>
	<br>
	Avec l'ère spatiale, l'espagnol s'est propagé naturellement vers les mondes terraformés des systèmes solaires proches, porté par des communautés dynamiques et des traditions de résistance.
	Souple, expressif, parfois chanté plus que parlé, il s'est adapté sans se diluer, intégrant volontiers des néologismes techniques tout en gardant ses tournures lyriques.<br>
	<br>
	Aujourd'hui, il est encore couramment parlé sur les planètes de la Frange Verte et dans certaines factions autonomes.
	Beaucoup de dialectes du Basic Galactique en portent la trace — dans les accents, les interjections, les proverbes... ou les insultes bien senties.<br>
	<br>
	Car si l'espagnol a appris une chose en mille ans d'histoire, c'est à survivre dans tous les climats. Même ceux de l'espace.
	[PAGEBREAK]

	<h1>Français</h1>
	[IMAGE: francais.png]
	Longtemps langue de la diplomatie, des arts et des révolutions, le français a connu des siècles d'alternance entre rayonnement et retrait.
	Mais avec l'Exode, son destin a basculé.
	Choisie comme langue officielle par le Haut Commandement pour sa précision, sa richesse conceptuelle et son prestige historique, elle est devenue le vecteur principal des communications stratégiques,
	des procédures de vol et des échanges entre les pilotes des flottes humaines.<br>
	<br>
	Le français utilisé aujourd'hui est une version épurée mais élégante, conservant ses structures formelles tout en s'adaptant aux réalités tactiques et technologiques.
	Il est enseigné dès l'enfance dans les académies militaires et les écoles de navigation, et reste un marqueur de statut dans de nombreux systèmes coloniaux.<br>
	<br>
	Les transmissions officielles, les journaux de bord, les codes de mission : tout parle français dans le silence des cockpits.<br>
	<br>
	Et dans les profondeurs du vide, cette langue continue de lier les pilotes à leur humanité.
	[PAGEBREAK]

	<h1>Hindi</h1>
	[IMAGE: hindi.png]
	Langue sacrée pour des millions d'êtres humains bien avant l'Exode, l'hindi a longtemps cohabité avec une multitude de parlers régionaux sur le sous-continent indien.
	Si son usage courant a diminué avec l'unification linguistique de certaines zones spatiales, elle a trouvé une seconde vie dans les milieux religieux et spirituels de l'univers colonisé.<br>
	<br>
	Temples et monastères orbitaux, sanctuaires installés dans les cratères de lunes oubliées : partout où l'homme cherche encore un sens à l'infini, on entend l'hindi chanté, psalmodié, médité.
	Les textes sacrés, les mantras et les prières interstellaires l'utilisent comme vecteur de paix intérieure et de connexion au tout.<br>
	<br>
	Même les IA de soutien psychologique ont appris à reconnaître la musicalité de l'hindi, et certains pilotes affirment qu'il aide à maintenir leur équilibre lors des longues traversées du néant.<br>
	<br>
	L'hindi n'est peut-être plus la langue des foules, mais elle est celle des âmes.
	[PAGEBREAK]

	<h1>Hollandais</h1>
	[IMAGE: hollandais.png]
	Autrefois langue des grands explorateurs maritimes, le hollandais a vu son rôle décliner au fil des siècles.
	Son usage quotidien s'est éteint avec la chute des puissances coloniales de la Terre, et il est aujourd'hui pratiquement disparu en tant que langue vivante.<br>
	<br>
	Cependant, son héritage perdure, à travers des vestiges de vocabulaire et des structures grammaticales qui ont fusionné avec d'autres langues.
	En particulier, plusieurs formes de créoles orbitaux ont intégré des éléments du hollandais dans leur lexique, héritant de son pragmatisme et de son amour pour les détails techniques.<br>
	<br>
	Les stations et vaisseaux qui portaient encore fièrement ce langage dans leurs inscriptions ou noms de quartiers ont disparu dans les archives.
	Pourtant, certains mots clés, comme wijk (quartier) ou dok (port), résonnent encore dans les couloirs des habitats lunaires et des anciens vaisseaux de commerce.<br>
	<br>
	Le hollandais n'est plus qu'un fantôme du passé, mais il continue de murmurer dans les recoins de l'univers.
	[PAGEBREAK]

	<h1>Italien</h1>
	[IMAGE: italien.png]
	Langue des poètes, des architectes, des artistes et des musiciens, l'italien a été un symbole de raffinement et de beauté pendant des siècles.
	Avant l'Exode, l'italien était omniprésent dans les cercles artistiques et les grandes écoles, où il nourrissait la création sous toutes ses formes.<br>
	<br>
	Dans l'univers spatial, l'italien n'a pas seulement survécu, il s'est transformé en une langue des émotions, de l'esthétique, et de l'inspiration.
	Les artistes, écrivains et performeurs des colonies stellaires continuent de l'utiliser pour créer des œuvres qui transcendent le quotidien.
	Le théâtre, la musique et la sculpture puisent souvent dans le riche vocabulaire italien pour décrire l'indescriptible.<br>
	<br>
	Bien que largement remplacé par des langues plus pratiques dans les échanges quotidiens, l'italien reste une langue sacrée pour ceux qui cherchent à donner forme à la beauté,
	et il résonne dans les galeries spatiales, les halls de musées orbitaux, et même dans les chambres de création des pilotes qui, de temps à autre, trouvent une inspiration inattendue en le parlant.
	[PAGEBREAK]

	<h1>Japonais</h1>
	[IMAGE: japonais.png]
	Langue d'une civilisation d'îles et de contrées technologiques, le japonais a toujours été empreint de discipline, de respect et de minutie.
	Avant l'Exode, le japonais était à la pointe de l'innovation, qu'il s'agisse de robotique, de philosophie ou de culture populaire.
	Les innovations japonaises en matière d'intelligence artificielle et de voyage spatial avaient déjà largement influencé les premières explorations humaines interstellaires.<br>
	<br>
	Avec l'Exode, le japonais a trouvé sa place dans la société galactique comme langue des techniciens, des ingénieurs et des stratèges.
	Ses structures succinctes et précises le rendent parfait pour les codes informatiques et les manuels techniques,
	tandis que son esthétique épurée est désormais un symbole d'élégance dans les protocoles spatiaux.<br>
	<br>
	Bien que le japonais soit principalement réservé aux communautés spécialisées et aux intelligences artificielles, il reste un pilier de la culture dans certaines zones.
	Des poèmes en <i>haiku</i> peuvent encore être entendus dans les temples flottants, et ses termes philosophiques, comme <i>wa</i> (harmonie) ou <i>mono no aware</i> (la beauté de l'éphémère),
	flottent dans l'air des discussions profondes entre pilotes.
	[PAGEBREAK]

	<h1>Norvégien</h1>
	[IMAGE: norvegien.png]
	Le norvégien, héritier des anciens peuples scandinaves, a longtemps été la langue des fjords, des montagnes enneigées et des rituels anciens.
	Avant l'Exode, il était parlé par des millions de personnes dans les régions nordiques de la Terre, mais sa place a progressivement diminué avec la mondialisation et la domination de l'anglais.<br>
	<br>
	Aujourd'hui, le norvégien est principalement réservé à quelques communautés sur des planètes éloignées, où l'héritage culturel scandinave continue de vivre dans des enclaves isolées.
	Il reste également la langue des expéditions polaires, des stations de recherche et des habitats extrêmes.
	Quelques groupes militent encore pour sa préservation, rappelant les légendes anciennes et les sagas racontées en norvégien, une langue de poésie et de nature.<br>
	<br>
	Dans les vastes étendues du vide intersidéral, le norvégien est devenu un murmure, presque un secret,
	une langue oubliée mais préservée dans les cœurs des nostalgiques et des derniers héritiers des anciennes terres du nord.
	[PAGEBREAK]

	<h1>Portugais</h1>
	[IMAGE: portugais.png]
	Autrefois langue de l'aventure et de la découverte, le portugais a marqué l'histoire par son rôle dans les grandes explorations maritimes et les premières routes commerciales intercontinentales.
	Mais au fil des siècles, alors que les nations se regroupaient et que l'espagnol prenait une place prépondérante dans les échanges interstellaires, le portugais a peu à peu disparu des radars.<br>
	<br>
	La langue a lentement fusionné avec l'espagnol dans de nombreuses régions, les frontières linguistiques devenant de plus en plus floues au fil des migrations et des métissages culturels.
	Il en reste néanmoins des traces : quelques expressions portuaires, des noms géographiques, et des chants de marins qui flottent dans l'air de certains secteurs côtiers.<br>
	<br>
	Dans les communautés anciennes de la Terre et dans les zones excentrées des colonies stellaires, le portugais est parfois encore parlé, mais il a perdu sa place officielle.
	Il subsiste dans les couches les plus profondes des dialectes, souvent à peine perceptibles parmi les variantes de l'espagnol.
	[PAGEBREAK]

	<h1>Russe</h1>
	[IMAGE: russe.png]
	Ancienne langue des grandes puissances terrestres, le russe a survécu aux bouleversements politiques et sociaux du passé pour devenir l'une des langues les plus parlées et respectées de l'univers.
	Dès les premiers jours de l'Exode, alors que l'humanité s'aventurait au-delà des frontières de la Terre, le russe s'imposa rapidement comme la langue des explorateurs intrépides,
	des scientifiques et des militaires qui colonisaient les mondes glacés des confins de l'espace.<br>
	<br>
	Fort de son alphabet cyrillique et de sa structure grammaticale rigoureuse, le russe reste la langue dominante dans plusieurs secteurs de la galaxie,
	particulièrement dans les stations situées sur des planètes aux climats extrêmes, où la culture robuste des peuples russes a forgé l'esprit pionnier nécessaire à la survie.<br>
	<br>
	Les transmissions dans les systèmes interstellaires sont souvent opérées en russe, et son usage est courant dans les missions de grande envergure,
	particulièrement celles impliquant des corps d'élite ou des projets de terraformation.
	Dans l'espace, il symbolise la résilience et l'endurance face à l'inconnu.<br>
	<br>
	Aujourd'hui, le russe se parle autant dans les stations de recherche que dans les bases militaires, et il reste un vecteur essentiel de communication interplanétaire,
	imprégné de l'héritage d'une époque de conquêtes infinies.
	[PAGEBREAK]

	<h1>Suédois</h1>
	[IMAGE: suedois.png]
	Le suédois, langue de la Terre du nord, a longtemps été un symbole de calme, de logique et de progrès.
	Avant l'Exode, il était parlé dans les régions scandinaves, au cœur des pays d'Europe du Nord, où il incarne l'harmonie entre nature et technologie.<br>
	<br>
	Bien que le suédois ne soit plus une langue largement parlée à l'échelle galactique, il a survécu dans des niches spécialisées, notamment dans les domaines de l'ingénierie avancée et de la recherche.
	Plusieurs systèmes de navigation, de terraformation et d'IA ont conservé des termes suédois dans leurs protocoles, héritage des grandes avancées technologiques de la région.<br>
	<br>
	Loin des grandes stations et des centres d'activité commerciale, le suédois demeure vivant dans des communautés résidentielles dans les zones froides et isolées de l'univers,
	où il est parlé avec une fierté douce et tranquille.
	Parfois, on l'entend dans les forums académiques ou au sein des équipes de recherche spatiale qui se concentrent sur des innovations discrètes mais essentielles.<br>
	<br>
	Comme les vents du nord qui balayent les fjords, le suédois reste une brise fraîche et discrète qui souffle au travers des âges.
	[PAGEBREAK]

	<h1>Swahili</h1>
	[IMAGE: swahili.png]
	Née sur les côtes de l'Afrique de l'Est, le swahili fut autrefois une langue de commerce, de brassage culturel et de connexion entre peuples.
	Avant l'Exode, elle unissait déjà des dizaines de millions de locuteurs et servait de pont entre traditions et modernité.<br>
	<br>
	Avec la chute des anciennes superpuissances et la réorganisation globale des flux migratoires, le swahili a trouvé une nouvelle vitalité dans les colonies spatiales émergentes.
	Utilisé d'abord dans les ports orbitaux et les zones de transit interplanétaires, il s'est peu à peu imposé comme une langue de terrain : pratique, expressive et chaleureuse.<br>
	<br>
	Aujourd'hui, on l'entend dans les marchés stellaires, les équipages civils, les convois de pionniers et les plateformes de coopération intercommunautaire.
	Le swahili est devenu la langue des lieux vivants, des échanges directs, et des civilisations en formation.<br>
	<br>
	Langue d'avenir autant que témoin d'un passé riche, elle incarne la résilience et l'esprit d'adaptation des peuples qui,
	depuis les rivages de l'océan Indien jusqu'aux confins du vide, ont toujours su faire lien.
	[PAGEBREAK]

	<h1>Thaï</h1>
	[IMAGE: thai.png]
	Le thaï, langue millénaire du sud-est asiatique, a traversé l'Exode en silence, portée par des communautés soudées, discrètes mais résolues à préserver leur identité.
	Peu utilisée en dehors de ses cercles d'origine, elle n'a jamais cherché à s'imposer à l'échelle galactique, préférant s'enraciner profondément dans les cœurs et les traditions.<br>
	<br>
	Aujourd'hui, le thaï est principalement parlé dans des enclaves culturelles fermées, souvent situées dans les zones résidentielles autonomes de grandes stations asiatiques.
	Là, les arts anciens cohabitent avec une technologie subtile, les temples holographiques s'élèvent entre les cours d'eau recyclés, et la langue thaïe se transmet avec une grande rigueur.<br>
	<br>
	Utilisé dans les cérémonies, les chants, les contes et la médecine traditionnelle, le thaï est une langue de filiation, un lien sacré entre générations.
	Si elle reste rare dans les communications interstellaires, elle demeure vivace dans les sphères privées, où elle protège un monde intérieur façonné de respect, d'harmonie et de mémoire.<br>
	<br>
	Comme un jardin suspendu dans le vide, le thaï reste là, intact et précieux.
	[PAGEBREAK]

	<h1>Turc</h1>
	[IMAGE: turc.png]
	À la croisée de l'Europe et de l'Asie, le turc a longtemps été une langue de transition, de dialogue entre mondes, d'empire et de diaspora.
	Avant l'Exode, elle portait encore les traces d'un passé riche en migrations, en conquêtes et en synthèses culturelles.<br>
	<br>
	Avec la dispersion des peuples dans les colonies spatiales, le turc a suivi un chemin discret mais continu.
	Sa force réside dans sa souplesse : il a absorbé de nombreux apports lexicaux, simplifié certaines structures, et s'est adapté aux réalités nouvelles sans jamais perdre son caractère.<br>
	<br>
	Aujourd'hui, le turc est encore bien vivant dans plusieurs zones commerciales et diplomatiques de la galaxie intérieure.
	On le parle dans des familles installées sur des générations entières de stations, où il est à la fois langue du quotidien et langue de la nostalgie.
	Il est aussi parfois utilisé dans certains cercles techniques, où sa logique agglutinante est appréciée dans des langages codés ou formels.<br>
	<br>
	Langue d'ancrage pour ceux qui cherchent leurs racines dans le tumulte spatial, le turc rappelle que même dans le vide, les ponts culturels ne s'effondrent jamais.
	[PAGEBREAK]

	<h1>Vietnamien</h1>
	[IMAGE: vietnamien.png]
	Langue tonale et poétique, le vietnamien a traversé les âges comme un fil tendu entre nature, guerre et renaissance.
	Avant l'Exode, il témoignait déjà d'un peuple résilient, capable de défendre ses terres comme de bâtir des diasporas partout sur la planète. Cette force tranquille s'est prolongée dans les étoiles.<br>
	<br>
	Le vietnamien a trouvé sa place dans des colonies agricoles autonomes, souvent installées sur des mondes terraformés aux écosystèmes humides ou tropicaux.
	Là, il est resté vivant, parlé au quotidien, transmis dans les chants, les proverbes et les récits ancestraux.<br>
	<br>
	S'il est rarement utilisé dans les circuits officiels ou militaires, le vietnamien demeure précieux dans les communautés solidaires et les réseaux logistiques discrets.
	Langue du soin, de l'organisation locale et du travail communautaire, il incarne un mode de vie fondé sur la patience, l'adaptation et la mémoire.<br>
	<br>
	Dans l'univers, on dit parfois que là où le vietnamien est parlé, la vie s'ancre avec humilité.
	[PAGEBREAK]
	
	[SECTION: Sécurité et maintenance du vaisseau]
	Inspection de la coque tous les 100 parsecs parcourus.
	Vérification des réacteurs à antimatière selon le protocole “Noyau Serein”.
	Présence obligatoire du pilote dans le cockpit lors de toute manœuvre sensible.
	[PAGEBREAK]
	
	[SECTION: Combinaison EV0-B]
	
	[PAGEBREAK]
`;

const imagePath = "/escaperpg/images/gaea1/manuel/",
	clic = new Audio('/escaperpg/sons/gaea1/interfaceclic.mp3'),
	prev = document.getElementById("precedent"),
	suiv = document.getElementById("suivant"),
	pageContainer = document.getElementById("page"),
	wrapper = document.getElementById("manuel-wrap"),
	manuel = document.getElementById("manuel"),
	btnPrev = document.getElementById("btnPrev"),
	btnNext = document.getElementById("btnNext");

let pages = [];
let tableOfContents = [];
let currentPage = 0;
let isAnimating = false;

async function adjustManuelSize() {
	let width = manuel.clientWidth;
	manuel.style.height = (width * 10) / 9 + "px";
	await splitTextIntoPages(fullText);
}

async function splitTextIntoPages(text) {
	pages = [];
	tableOfContents = [];
	pageContainer.innerHTML = "";

	const rawSections = text.split(/\[PAGEBREAK\]/).map(s => s.trim());

	for (let i = 0; i < rawSections.length; i++) {
		let section = rawSections[i];
		let currentPageText = "";
		pageContainer.innerHTML = "";

		const manuelStyles = window.getComputedStyle(manuel);
		const paddingTop = parseFloat(manuelStyles.paddingTop);
		const paddingBottom = parseFloat(manuelStyles.paddingBottom);

		pageContainer.innerHTML = getBackButtonHTML();
		const buttonHeight = pageContainer.firstElementChild.getBoundingClientRect().height;
		const maxHeight = manuel.clientHeight - paddingTop - paddingBottom - buttonHeight;
		const parts = section.split(/(\[IMAGE:\s*.+?\])/g);

		for (let j = 0; j < parts.length; j++) {
			let part = parts[j].trim();

			if (part.startsWith("[IMAGE:")) {
				const imageName = part.match(/\[IMAGE:\s*(.+?)\]/)[1];
				const imageTag = `<img src="${imagePath}${imageName}">`;

				let nextText = "";
				if (j + 2 < parts.length && !parts[j + 2].startsWith("[IMAGE:")) {
					nextText = parts[j + 2].trim();
					j++;
				}
				
				const onlyBackButton = currentPageText.trim() === getBackButtonHTML().trim();
				const hasTextBefore = currentPageText.trim().length > 0 && !onlyBackButton;
				const { imageHTML, remainingText } = await handleImageWithText({
					imageTag,
					nextText,
					currentPageText,
					hasTextBefore,
					maxHeight
				});

				currentPageText = imageHTML;

				if (remainingText.trim().length > 0) {
					const words = remainingText.split(" ");
					for (let w = 0; w < words.length; w++) {
						const testText = `${currentPageText} ${words[w]}`;
						pageContainer.innerHTML = getBackButtonHTML() + testText;
						if (pageContainer.getBoundingClientRect().height > manuel.clientHeight - paddingTop - paddingBottom) {
							pages.push(currentPageText.trim());
							currentPageText = `${words[w]} `;
						}
						else { currentPageText += ` ${words[w]}`; }
					}
				}

			} else {
				part = part.replace(/\[SECTION:\s*(.+?)\]\s*(.*)/, (match, title, rest) => {
					tableOfContents.push({ title, page: pages.length + 2 });
					return `<h1>` + title + `</h1>` + rest;
				});

				let words = part.split(" ");
				for (let k = 0; k < words.length; k++) {
					let testText = currentPageText + words[k] + " ";
					pageContainer.innerHTML = getBackButtonHTML() + testText;
					if (pageContainer.getBoundingClientRect().height > manuel.clientHeight - paddingTop - paddingBottom) {
						pages.push(currentPageText.trim());
						currentPageText = words[k] + " ";
					}
					else { currentPageText = testText; }
				}
			}
		}

		if (currentPageText.trim().length > 0) { pages.push(currentPageText.trim()); }
	}

	let intro = `<div class="citation">"Nous ne naviguons pas pour conquérir, mais pour comprendre."</div><h3 class="auteur">— Amirale Kaelen Vos, 2492.</h3>
		Depuis près d'un millénaire, l'humanité a étendu ses frontières bien au-delà des anciennes limites du système solaire. De nouveaux mondes ont été découverts, cartographiés et colonisés.<br>
		<br>
		Pourtant, l'inconnu reste vaste.<br>
		<br>
		En tant que pilote de vaisseau d'exploration de classe <i>Horizon</i>, votre rôle est essentiel pour l'avenir de notre espèce.<br>
		Ce manuel vous guidera dans les situations critiques où vos décisions influenceront bien plus que votre propre destin.
	`;
	pages.unshift(intro);

	let tocHTML = "<h1>MANUEL DU PILOTE</h1><h2>EXPLORATION INTERSTELLAIRE</h2><h2>— VAISSEAU DE CLASSE HORIZON —</h2><h3>Version 3.14.0.6</h3><ul>";
	tableOfContents.forEach(item => { tocHTML += `<li><button onclick="goToPage(${item.page})">${item.title}</button></li>`; });
	tocHTML += `</ul><h4>Ce manuel est à destination exclusive des pilotes de la flotte d'exploration.
		Il détaille les protocoles essentiels pour assurer la sécurité du pilote et la réussite des missions d'exploration.</h4>`;
	pages.unshift(tocHTML);

	renderPage();
}

async function handleImageWithText({ imageTag, nextText, currentPageText, hasTextBefore, maxHeight }) {
	const testBefore = hasTextBefore ? currentPageText + "<br><br>" + imageTag : imageTag + "<br>";
	pageContainer.innerHTML = testBefore;
	await waitForImagesToLoad(pageContainer);

	if (pageContainer.getBoundingClientRect().height > maxHeight) {
		if (hasTextBefore) pages.push(currentPageText.trim());
		currentPageText = "";

		pageContainer.innerHTML = imageTag;
		await waitForImagesToLoad(pageContainer);

		if (pageContainer.getBoundingClientRect().height > maxHeight) {
			pages.push(`<div class="centered">${imageTag}</div>`);
			return { imageHTML: "", remainingText: nextText };
		}

		return { imageHTML: imageTag + "<br>", remainingText: nextText };
	}

	const words = nextText.split(" ");
	let afterImageText = "";
	let addedAfter = false;

	for (let k = 0; k < words.length; k++) {
		const testText = testBefore + "<br>" + afterImageText + words[k] + " ";
		pageContainer.innerHTML = testText;
		await waitForImagesToLoad(pageContainer);

		if (pageContainer.getBoundingClientRect().height > maxHeight) { break; }
		afterImageText += words[k] + " ";
		addedAfter = true;
	}

	const imageHTML = testBefore + (addedAfter ? "<br>" + afterImageText.trim() : "");
	return {
		imageHTML,
		remainingText: nextText.slice(afterImageText.length).trim()
	};
}

function getBackButtonHTML() {
	return `<div class="back-to-toc"><button onclick="goToPage(0)">← Retour au sommaire</button></div>`;
}

function renderPage(direction = null) {
	if (isAnimating) return;
	isAnimating = true;

	pageContainer.style.pointerEvents = "none";
	pageContainer.classList.add("waiting");
	wrapper.classList.add("waiting");
	
	let content = pages[currentPage] || "";
	if (currentPage !== 0) { content = getBackButtonHTML() + content; }

	const newPage = document.createElement("div");
	newPage.classList.add("page-content");
	if (direction === "left") { newPage.classList.add("slide-in-left"); }
	else if (direction === "right") { newPage.classList.add("slide-in-right"); }
	newPage.innerHTML = content;

	const oldPage = pageContainer.querySelector(".page-content");
	if (oldPage) {
		if (direction === "left") { oldPage.classList.add("slide-out-left"); }
		else if (direction === "right") { oldPage.classList.add("slide-out-right"); }
		oldPage.addEventListener("animationend", () => {  oldPage.remove();  });
	}
	else { pageContainer.innerHTML = ""; }

	newPage.addEventListener("animationend", () => {
		prev.style.visibility = currentPage === 0 ? "hidden" : "visible";
		suiv.style.visibility = currentPage + 1 === pages.length ? "hidden" : "visible";
		isAnimating = false;
		pageContainer.style.pointerEvents = "auto";
		pageContainer.classList.remove("waiting");
		wrapper.classList.remove("waiting");
		btnPrev.src = "/escaperpg/images/gaea1/gauche.png";
		btnNext.src = "/escaperpg/images/gaea1/droite.png";
	});

	pageContainer.appendChild(newPage);

	if (!direction) {
		isAnimating = false;
		pageContainer.style.pointerEvents = "auto";
		pageContainer.classList.remove("waiting");
		wrapper.classList.remove("waiting");
	}
}

function precedent() {
	if (isAnimating || currentPage === 0) return;
	clic.play();
	btnPrev.src = "/escaperpg/images/gaea1/gaucheclick.png";
	currentPage--;
	renderPage("right");
}

function suivant() {
	if (isAnimating || currentPage + 1 >= pages.length) return;
	clic.play();
	btnNext.src = "/escaperpg/images/gaea1/droiteclick.png";
	currentPage++;
	renderPage("left");
}

function goToPage(index) {
	if (index < pages.length) {
		clic.play();
		const direction = index > currentPage ? "left" : "right";
		currentPage = index;
		renderPage(direction);
	}
}

function waitForImagesToLoad(container) {
	const images = container.querySelectorAll("img");
	const promises = Array.from(images).map(img => {
		if (img.complete) return Promise.resolve();
		return new Promise(resolve => {
			img.onload = img.onerror = () => resolve();
		});
	});
	return Promise.all(promises);
}

window.addEventListener("keydown", (e) => {
	if (isAnimating) return;
	if (e.key === "ArrowRight" || e.key === "d") { suivant(); }
	else if (e.key === "ArrowLeft" || e.key === "q") { precedent(); }
});

window.addEventListener("resize", () => {
	adjustManuelSize();
	isAnimating = false;
	pageContainer.style.pointerEvents = "auto";
	pageContainer.classList.remove("waiting");
	wrapper.classList.remove("waiting");
});

window.addEventListener("load", async () => {
  const contentContainer = document.getElementById("page");
  await waitForImagesToLoad(contentContainer);
  adjustManuelSize();
});